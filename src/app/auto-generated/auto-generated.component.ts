import { Component, OnInit } from '@angular/core';
import { AccelerometerData } from './types/AcceleroMeterData.type';
import { CreateViewEventData } from 'tns-core-modules/ui/placeholder';

@Component({
  selector: 'app-auto-generated',
  templateUrl: './auto-generated.component.html',
  styleUrls: ['./auto-generated.component.css']
})
export class AutoGeneratedComponent implements OnInit {

  public accelerometerData: AccelerometerData;
  public canvas: globalAndroid.graphics.Canvas;
  private canvasWidth: number;
  private canvasHeight: number;

  constructor() { }

  ngOnInit() {
    this.canvasWidth = 1000;
    this.canvasHeight = 1000;
  }

  public startAccelerometer(): void {
    const accelerometer = require('nativescript-accelerometer');
    accelerometer.startAccelerometerUpdates((data: AccelerometerData) => {
      this.accelerometerData = data;
      this.draw();
    }, { sensorDelay: 'ui' });
  }

  public draw(): void {
    const blueColor = new android.graphics.Paint();
    blueColor.setARGB(255, 255, 0, 0);
    blueColor.setAntiAlias(true);
    this.canvas.drawCircle(this.accelerometerData.x * 750 + (this.canvasWidth / 2) ,
                           this.accelerometerData.y * -750 + (this.canvasHeight / 2), 10, blueColor );
  }

  private drawBorder(): void {
    const blackColor = new android.graphics.Paint();
    blackColor.setStrokeWidth(10);
    blackColor.setARGB(255, 0, 0, 0);
    blackColor.setAntiAlias(true);
    this.canvas.drawLine( 0, 0, 0, this.canvasHeight, blackColor);
    this.canvas.drawLine( 0, 0, this.canvasWidth, 0, blackColor);
    this.canvas.drawLine( this.canvasWidth, 0, this.canvasWidth, this.canvasHeight, blackColor);
    this.canvas.drawLine( 0, this.canvasHeight, this.canvasWidth, this.canvasHeight, blackColor);
  }

  public InitCanvas(args: CreateViewEventData): void {
    const nativeView = new android.widget.ImageView(args.context);
    nativeView.setScaleType(android.widget.ImageView.ScaleType.FIT_XY);
    const bitmap = android.graphics.Bitmap.createBitmap(this.canvasWidth, this.canvasHeight, android.graphics.Bitmap.Config.ARGB_8888);
    this.canvas = new android.graphics.Canvas(bitmap);
    this.drawBorder();
    nativeView.setImageBitmap(bitmap);
    args.view = nativeView;
  }

  public startProoving(): void {
    console.log('startProoving');
  }
}
